# 工作空间侧边栏功能说明

## 概述

本文档介绍了Sugar应用中新增的工作空间侧边栏功能，该功能为用户提供了一个直观的文件和文件夹管理界面，支持多工作空间、文件搜索、收藏管理等功能。

## 功能特性

### 1. 多工作空间支持
- 支持在多个团队工作空间之间切换
- 每个工作空间独立管理文件和文件夹
- 工作空间选择器位于侧边栏顶部

### 2. 文件树形结构
- 层级化显示文件和文件夹
- 支持文件夹展开/折叠
- 区分文件和文件夹的图标显示
- 鼠标悬停显示操作按钮

### 3. 搜索功能
- 实时搜索文件和文件夹
- 支持模糊匹配
- 搜索结果高亮显示
- 一键清除搜索结果

### 4. 三个视图模式
- **文件树视图**: 显示完整的文件夹层级结构
- **最近访问**: 显示最近打开的文件列表
- **收藏**: 显示用户收藏的文件和文件夹

### 5. 文件操作
- 新建文件夹
- 新建文件
- 重命名文件/文件夹
- 删除文件/文件夹
- 收藏/取消收藏

### 6. 侧边栏控制
- 支持折叠/展开侧边栏
- 响应式设计，适配不同屏幕尺寸
- 折叠状态下显示快捷操作按钮

## 技术架构

### 组件结构
```
web/src/
├── components/
│   ├── Sidebar.vue           # 侧边栏容器组件
│   └── WorkspaceTree.vue     # 工作空间树形组件
├── composables/
│   └── useWorkspace.ts       # 工作空间管理组合式函数
├── api/sugar/
│   └── sugarFolders.js       # 文件夹相关API
├── types/
│   └── api.ts                # TypeScript类型定义
└── view/sugar/
    └── index.vue             # 主页面（已集成侧边栏）
```

### 数据模型
```typescript
interface WorkspaceTreeNode {
  id: string
  name: string
  type: 'folder' | 'file'
  parentId?: string
  teamId: string
  children?: WorkspaceTreeNode[]
  content?: any
  createdAt?: string
  updatedAt?: string
  createdBy?: string
  updatedBy?: string
}
```

### API接口
- `getWorkspaceTree()` - 获取工作空间文件树
- `createFolder()` - 创建文件夹
- `renameItem()` - 重命名文件/文件夹
- `deleteItem()` - 删除文件/文件夹
- `moveItem()` - 移动文件/文件夹

## 使用方法

### 基本操作

1. **切换工作空间**
   - 点击顶部的工作空间选择器
   - 选择要切换的工作空间

2. **搜索文件**
   - 在搜索框中输入关键词
   - 系统会实时显示匹配的文件和文件夹
   - 点击"清除"按钮清空搜索结果

3. **创建文件夹**
   - 点击"新建文件夹"按钮
   - 或右键点击文件夹选择"新建文件夹"

4. **创建文件**
   - 点击"新建文件"按钮
   - 或右键点击文件夹选择"新建文件"

5. **重命名**
   - 鼠标悬停在文件/文件夹上，点击编辑图标
   - 或右键选择"重命名"
   - 在弹出的对话框中输入新名称

6. **删除**
   - 鼠标悬停在文件/文件夹上，点击删除图标
   - 或右键选择"删除"
   - 确认删除操作

7. **收藏管理**
   - 点击星形图标添加/取消收藏
   - 在"收藏"标签页查看所有收藏项

### 高级功能

1. **最近访问**
   - 系统自动记录最近打开的文件
   - 最多保存10个最近访问的文件
   - 支持一键清空最近访问记录

2. **侧边栏控制**
   - 点击折叠按钮隐藏/显示侧边栏
   - 折叠状态下仍可通过图标快速展开

3. **响应式设计**
   - 在移动设备上，侧边栏会自动适配屏幕尺寸
   - 支持触摸操作

## 本地存储

系统会在浏览器本地存储以下数据：
- 最近访问的文件列表
- 收藏的文件和文件夹
- 工作空间设置（排序方式、显示选项等）

## 扩展性

### 添加新的文件操作
可以通过扩展`useWorkspace`组合式函数来添加新的文件操作功能。

### 自定义文件类型
可以在`WorkspaceTreeNode`类型中扩展`type`字段，支持更多文件类型。

### 集成外部存储
可以通过修改API接口来集成云存储或其他外部存储服务。

## 注意事项

1. **服务端支持**: 需要确保服务端实现了相应的API接口
2. **权限控制**: 文件操作需要考虑用户权限和团队权限
3. **性能优化**: 大量文件时建议实现懒加载和虚拟滚动
4. **错误处理**: 网络错误和操作失败时会显示相应的错误提示

## 后续优化建议

1. **拖拽支持**: 支持文件和文件夹的拖拽移动
2. **批量操作**: 支持多选和批量删除/移动
3. **文件预览**: 鼠标悬停时显示文件预览
4. **快捷键**: 添加键盘快捷键支持
5. **同步状态**: 显示文件同步状态和冲突解决
6. **版本历史**: 支持文件版本历史查看和恢复

## 故障排除

### 常见问题

1. **侧边栏不显示**
   - 检查组件是否正确导入
   - 确认API接口是否正常响应

2. **搜索功能异常**
   - 检查搜索关键词是否包含特殊字符
   - 确认数据加载是否完成

3. **文件操作失败**
   - 检查网络连接
   - 确认用户权限
   - 查看浏览器控制台错误信息

### 调试方法

1. 打开浏览器开发者工具
2. 查看Console面板的错误信息
3. 检查Network面板的API请求状态
4. 使用Vue DevTools查看组件状态

## 更新日志

### v1.0.0 (2025-01-08)
- 初始版本发布
- 实现基本的文件树功能
- 支持搜索、收藏、最近访问
- 集成到主页面